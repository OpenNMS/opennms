
= Develop Custom Event Forwarder

The event forwarder listens for _all_ events on the internal event bus of _{product-title}_.
Events from the bus are sent to a _Camel_ processor, which can filter or transform these, before being sent to the _AMQP_ endpoint.

The event forwarder exposes the following properties via the `org.opennms.features.amqp.eventforwarder` pid:

[options="header"]
|===
| Property      | Default                                                         | Description
| connectionUrl | amqp://guest:guest@onms/test?brokerlist=\'tcp://127.0.0.1:5672' | Used by the AMQPConnectionFactory. See http://people.apache.org/~grkvlt/qpid-site/qpid-java/qpid-client/apidocs/org/apache/qpid/jms/ConnectionURL.html[ConnectionURL]
 for a full list of options.
| destination   | amqp:OpenNMS-Exchange/opennms-routing-key                       | Target queue or topic. See http://camel.apache.org/amqp.html[AMQP] for details.
| processorName | default-event-forwarder-processor                               | Name `org.apache.camel.Processor` used to filter and/or format the events.
|===

The default processor, the `default-event-forwarder-processor`, marshalls events to XML and does not perform any filtering.
This means that when enabled, all events will be forwarded to the _AMQP_ destination with XML strings as the message body.

== Setup

Start by logging into a Karaf shell.

Update the properties with your deployment specific values:

[source]
----
config:edit org.opennms.features.amqp.eventforwarder
config:property-set connectionUrl amqp://guest:guest@onms/test?brokerlist=\'tcp://127.0.0.1:5672\'
config:property-set destination amqp:OpenNMS-Exchange/opennms-routing-key
config:property-set processorName default-event-forwarder-processor
config:update
----

Install the feature:

[source]
----
feature:install opennms-amqp-event-forwarder
----

== Debugging

You can get detailed information on the Camel route using:

[source]
----
camel:route-info forwardEvent
----
