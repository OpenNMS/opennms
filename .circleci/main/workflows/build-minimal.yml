workflows:
  build-minimal:
    when:
      and:
        - equal: [ false, << pipeline.parameters.trigger-coverage >> ]
        - equal: [ true, << pipeline.parameters.trigger-build >> ]
        - equal: [ true, << pipeline.parameters.minimal >> ]
    jobs:
      - build
      - create-merge-foundation-branch:
          requires:
            - build
          filters:
            branches:
              only: << pipeline.parameters.main_branch >>
      - merge-foundation-branch:
          requires:
            - build
          filters:
            branches:
              only: merge-foundation/<< pipeline.parameters.previous_branch_label >>-to-<< pipeline.parameters.main_branch_label >>
      - create-merge-meridian-branch:
          requires:
            - build
          filters:
            branches:
              only: /^foundation.*/
      - merge-poweredby-branch:
          # technically only requires the RPM/deb builds, but only publish
          # if everything passes
          requires:
            - build
          filters:
            branches:
              only:
                - /^foundation.*/
