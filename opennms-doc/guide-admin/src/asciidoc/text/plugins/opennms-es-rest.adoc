
// Allow GitHub image rendering
:imagesdir: ../../images

==== OpenNMS Elastic Search ReST plugin

The _OpenNMS Elastic Search ReST plugin_ provides an interface to forward events, alarms and alarm change events generated by
 the _Alarm Change Notifier Plugin_ to Elastic Search (https://github.com/elastic/elasticsearch)
 
This plugin uses the Elastic Search ReST interface and can interact cloud hosted with Elastic Search instances. 
The interface has been tested with Elastic Search 2.x. 

The _OpenNMS Elastic Search ReST plugin_ uses the Jest library (https://github.com/searchbox-io/Jest) to access the Elastic Search ReST interface.

Please note that a previous OpenNMS Elastic Search interface used the Camel Elastic Search plugin (http://camel.apache.org/elasticsearch.html)
to talk directly to the internal Elastic Search API. This was limited to Elastic Search 1.x and could not work with cloud hosted Elastic Search
 instances because they only expose the ReST interface.
 
==== configuration

configuration is held in /etc/org.opennms.plugin.elasticsearch.rest.forwarder.cfg

with the following properties (defaults shown will be used if file is not present)

----
## url of elastic search ReST interface
elasticsearchUrl=http://localhost:9200

## username and password to access Elastic Search 
esusername=""

espassword=""

## log the event description - often omitted because lots of redundant text
logEventDescription=true

## archive raw OpenNMS events
archiveRawEvents=true

## archive OpenNMS alarms
archiveAlarms=true

## archive OpenNMS alarm change events
archiveAlarmChangeEvents=true

## for alarm change events we can choose to archive the detailed alarm values but this is expensive. Set false in production.
archiveOldAlarmValues=true

archiveNewAlarmValues=true
----

==== Index Definitions

Three indexes are created; one for alarms, one for alarm change events and one for raw events. 
Alarms and alarm change events are only saved if the alarm-change-notifier plugin is also 
installed to generate alarm change events from the OpenNMS alarms table. 
The index names are of the form;

<name>-<date>/type/id

For example

a) alarms

opennms-alarms-2016.08/alarmdata/1823

b) alarm change events

opennms-events-alarmchange-2016.08/eventdata/11549

c) raw OpenNMS events (not including alarm change events

opennms-events-raw-2016.08/eventdata/11549

==== Viewing events using Kibana Sense 

Kibana Sense is a Kibana app which allows you to run queries directly against Elastic Search
(https://www.elastic.co/guide/en/sense/current/installing.html)

If you install Kibana Sense you can use the following commands to view the alarms and events sent to Elastic Search

Example searches to use in Kibana Sense
----
GET /opennms-alarms-*/_search

GET /opennms-alarms-*/

GET opennms-alarms-2016.08/alarmdata/1823

DELETE /opennms-alarms-*/

GET /opennms-events-*/_search

GET /opennms-events-raw*/_search

DELETE /opennms-events-*/

GET /opennms-events-raw*/

GET /opennms-events-alarmchange-*/

GET opennms-events-alarmchange-*/_search

GET opennms-events-alarmchange-2016.08/eventdata/11549
----
