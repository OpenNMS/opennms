
// Allow GitHub image rendering
:imagesdir: ../../../images

=== Business Service Daemon

The calculation of the _Operational Status_ of the _BS_ is driven by the _Business Service Monitoring Daemon_ (bsmd).
The daemon is responsible for tracking the operational status of all _BS_ and for sending events in case of operational status changes.

In order to calculate the _Operational Status_ the _reduction key_ associated with a _Business Service_ is used.
The _reduction key_ is obtained from an alarm generated by _{opennms-product-name}_.
This means that the alarm's _reduction key_ of a defined _Business Service_ must not change afterwards.
Otherwise _bsmd_ is not able to calculate the _Operational Status_ correctly.
This also applies for removing the _alarm data_ from events associated to _Business Services_
In addition the child type "IP Service" from the _Business Service Configuration Page_ requires the following events with the default reduction keys being defined:
 * uei.opennms.org/nodes/nodeLostService
 * uei.opennms.org/nodes/nodeDown
 * uei.opennms.org/nodes/interfaceDown

Every time the configuration of a _Business Service_ is changed a reload of the daemon's configuration is required.
This includes changes like the name of the _Business Service_ or its attributes as well as changes regarding the _Reduction Keys_, contained _Business Services_ or _IP Services_.
The _bsmd_ configuration can be reloaded with the following mechanisms:

* Click the _Reload Daemon_ button in the _Business Service Editor_
* Send the _reloadDaemonConfig_ event using `send-event.pl` or use the WebUI in _Manually Send an Event_ with parameter `daemonName bsmd`
* Use the ReST API to perform a `POST` request to `/opennms/api/v2/business-services/daemon/reload`

If the reload of the configuration is done an event of type `uei.opennms.org/internal/reloadDaemonConfigSuccessful` is fired.

.Example reloading bsmd configuration from CLI
[source,shell]
----
$OPENNMS_HOME/bin/send-event.pl -p 'daemonName bsmd' uei.opennms.org/internal/reloadDaemonConfig
----

.Example reloading bsmd configuration through ReST POST
[source,shell]
----
curl -X POST -u admin:admin -v http://localhost:8980/opennms/api/v2/business-services/daemon/reload
----
