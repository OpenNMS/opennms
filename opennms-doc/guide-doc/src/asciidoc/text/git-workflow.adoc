
== The use of JIRA and the GitHub workflow
In Github every code contribution that is provided through a pull request should be driven by a known JIRA issue.
JIRA is the central management tool used to create and maintain releases for OpenNMS.
To ensure that your contribution is tracked in the release management it is essential that there is a related JIRA issue for your pull requests.

You are required to have a link:http://issues.opennms.org/secure/Signup!default.jspa[JIRA account] for the creation of, and commenting on, issues and a link:https://github.com/join[GitHub account] for providing your contribution as pull request.

The following example describes a workflow for how to contribute documentation for the DnsMonitor.

The initial step is to fork the OpenNMS project.
A guide how to fork a project on GitHub can be found on this GitHub help page link:https://help.github.com/articles/fork-a-repo[Fork a repository].

The next step is to pick the JIRA issue you wish to work on.
The JIRA issue number is important to recognize the issue and is therefore used as a reference.

.Pick the issue in JIRA you want to work on
image::../images/01_pick-issue.png[]

It might be easier at this stage to open a second browser tab and navigate to your GitHub account with your repositories.
Select your fork, identified by having your Github username at the start, from the previously forked OpenNMS project. 
Switch to the appropriate branch using the dropdown selection box or by use of the input field autocompletion. 
You need to select the _development/docs_ branch.

.Switch to the development/docs branch
image::../images/02_switch-to-dev-docs-branch.png[]

Now create a working branch for the JIRA issue you want to work with.
The name schema has the following pattern: +

_NMS-<number>-docs-<Subject-without-spaces>_

which is this example: _NMS-6634-docs-DnsMonitor_
This name will be used later in the pull request and helps to identify the issue you wish to work on.
If you like you can just type in the name in the input field and if the branch does not currently exist GitHub will create it automatically for you.

.Create a working branch for the JIRA issue in your repository
image::../images/03_create-branch-from-dev-docs.png[]

If you want to work locally and you want to be able to work offline, you can clone a repository to you local computer with:

 git clone https://github.com/<your-github-nick>/opennms.git

It will download the repository with all the branches to your local system in the 'opennms' directory.
By default you are in the _master branch_ of OpenNMS.
You can switch to your previously created working branch with this command:

 git checkout -b NMS-6634-docs-DnsMonitor origin/NMS-6634-docs-DnsMonitor

Now you have your working branch where you can start your contribution.

.Your contribution and save it!
image::../images/04_your-contribution.png[]

After you finished your contribution in code or documentation it is time to save your work in your public GitHub repository.
Use this command:

 git status

to show you which changes you have made in regards to the last status determined from your checkout in your repository.
To add your changes to the version controlled history you must add your changed files to the commit.
In our case we have created the 'DnsMonitor.adoc' file and it is shown as currently untracked in git.

The command:

 git add DnsMonitor.adoc

adds this file for the next commit.

NOTE: The full path to the file to add depends on your current location in the file system. 
If you are not in the same directory as the file when you use add then you must provide the path as part of the command.

.Add your created or modified files with git add.
image::../images/05_add-to-git.png[]

It is useful to wwrite a comment which explains what you did, comments can be incredibly helpful to monitor and track git changes across a multiple user commits.
The standard we use here is that the first line is used as a subject line and should contain the JIRA issue number and the JIRA issue subject.
After the subject keep one empty line and you can use bulletpoints to describe your changes:

.Git comment with a subject line and bullet points for the description
image::../images/06_git-comment.png[]

You have now changed your local working copy and it is time to push the change to your GitHub repository with the following:

 git push

.Upload your changes to your GitHub repository
image::../images/07_git-push.png[]

Sometimes an issue isn't completed in a single day and will take a longer period of time.
Give others the possibility to track the progress of your working branch by setting a link to it in the JIRA issue that you are working with.
This indicates someone is already working on the issue, it also allows them the possibility to give you a contribution.

.Set a link to your working branch if you've started your work
image::../images/08_link-to-working-branch.png[]

Once you have completed, or wish to push upstream your contribution into the main code base of OpenNMS you must create a _pull request_ from your working branch against the OpenNMS repository.

.Click on _Compare & pull request_
image::../images/09_compare-branches.png[]

The next dialog prepares your _pull request_ and you have to make sure you make the _pull request_ against the relevant OpenNMS branch. 
For the purposes of our example this would be the 'OpenNMS:development/docs' branch.
By default you will see _OpenNMS:master_, you can change the branch by clicking on _Edit_(1) and switching from _OpenNMS:master_ to _OpenNMS:development/docs_(2).
GitHub will use your last git commit message for the _pull request_ and you have a chance to add or change the commit message before sending the _pull request_.

.Switch target branch from OpenNMS:master to OpenNMS:development/docs
image::../images/10_select-dev-docs.png[]

After you have clicked on the _Create pull request_ button, your _pull request_ will now queued for review and potential inclusion.

.Created pull request queued for review
image::../images/11_pull-request-for-review.png[]

To indicate you need your changes reviewing set a link for the _pull request_ in the JIRA issue.

.Set a link for reviewing to the pull request in JIRA
image::../images/12_doc-pull-request-issue.png[]

Your _pull request_ will now be reviewed.

The reviewer may add annotations lines to your contributed changes.
You can integrate these comments by just making your changes in your working branch, commit and push them to your repository.
GitHub will automatically add the commits to your pull requests.
The reviewer will then decide whether to merge your _pull request_ to the official OpenNMS repository.

.Example for a review on a _pull request_ for a contribution
image::../images/13_pull-request-review-comments.png[]

When a reviewer merges your _pull request_ to the official OpenNMS project, the status is indicated on your GitHub profile page.

.Status of pull requests is indicated on your GitHub profile page
image::../images/14_merged-pull-request.png[]

The OpenNMS Continuous Integration system based on _Bamboo_ picks up the merged pull request and starts a build then deploys a version with your changes automatically. 
You can see the built items on the publically available link:http://bamboo.internal.opennms.com:8085/allPlans.action[Bamboo system].
