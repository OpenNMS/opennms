<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0" xsi:schemaLocation=" http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd http://www.osgi.org/xmlns/blueprint-ext/v1.1.0 https://svn.apache.org/repos/asf/aries/tags/blueprint-0.3.1/blueprint-core/src/main/resources/org/apache/aries/blueprint/ext/blueprint-ext.xsd">
 
    <reference id="graphDao" interface="org.opennms.netmgt.dao.GraphDao" />
    <reference id="resourceDao" interface="org.opennms.netmgt.dao.ResourceDao" />
    <reference id="snmpAgentConfigFactory" interface="org.opennms.netmgt.config.SnmpAgentConfigFactory" />
    
    <bean id="nrtController" class="org.opennms.nrtg.web.internal.NrtController">
        <property name="graphDao" ref="graphDao" />
        <property name="resourceDao" ref="resourceDao" />
        <property name="snmpAgentConfigFactory" ref="snmpAgentConfigFactory" />
        <property name="nrtBroker" ref="nrtBroker" />
    </bean>

    <bean id="nrtBroker" class="org.opennms.nrtg.web.internal.NrtBrokerJms" >
        <property name="jmsTemplate" ref="jmsTemplate" />
    </bean>

    <bean id="amqConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
        <property name="brokerURL" value="tcp://127.0.0.1:61616"/>
    </bean>

    <bean id="jmsExceptionListener" class="org.opennms.nrtg.web.internal.JmsExceptionListener"/>

    <bean id="connectionFactory" class="org.springframework.jms.connection.CachingConnectionFactory">
        <property name="targetConnectionFactory" ref="amqConnectionFactory"/>
        <property name="sessionCacheSize" value="8"/>
        <property name="exceptionListener" ref="jmsExceptionListener"/>
    </bean>

    <bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate">
        <property name="connectionFactory" ref="connectionFactory"/>
        <property name="deliveryPersistent" value="false"/>
        <property name="deliveryMode" value="1"/>
        <property name="explicitQosEnabled" value="true"/>
        <property name="timeToLive" value="120000"/>
    </bean>
  
    <bean id="nrtServlet" class="org.opennms.nrtg.web.internal.NrtServlet">
        <property name="controller" ref="nrtController" />
    </bean>
  
    <service interface="javax.servlet.Servlet" ref="nrtServlet" >
        <service-properties>
            <entry key="alias" value="/nrt/starter" />
        </service-properties>
    </service>
    
    <bean id="amqAjaxServlet" class="org.opennms.nrtg.web.internal.NrtAmqAjaxServlet" />
    <service interface="javax.servlet.Servlet" ref="amqAjaxServlet">
        <service-properties>
            <entry key="alias" value="/amq" />
            <entry key="org.apache.activemq.brokerURL" value="tcp://127.0.0.1:61616" />
        </service-properties>
    </service>    
</blueprint>
