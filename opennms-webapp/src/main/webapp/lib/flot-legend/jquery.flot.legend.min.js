/*! flot-legend 1.0.0-SNAPSHOT - built on 2015-10-21 */
!function(a){"use strict";function b(a,b){this.plot=a,this.opts=b,this.badgeSize=this.opts.legend.style.badgeSize,this.fontSize=this.opts.legend.style.fontSize,this.lineWidth=this.getLineWidth()}function c(a){for(var b=[],c=[],d={},e=/^%(\d*)(\.(\d+))?lf/,f=function(a){d.hasOwnProperty(a)?d[a]+=1:d[a]=1},g=function(a){return d.hasOwnProperty(a)?d[a]:0},h=function(a){b.length>0&&(c.push({type:i.Text,value:b.join("")}),b=[],f(i.Text)),void 0!==a&&(c.push(a),f(a.type))},j=0,k=a.length;k>j;j++){var l,m=a[j],n=a[Math.min(j+1,k-1)];if("%"===m&&"g"===n)h({type:i.Badge}),j++;else if("%"===m&&"s"===n)h({type:i.Unit}),j++;else if("%"===m&&"%"===n)b.push("%"),j++;else if("\\"==m&&"n"==n)h({type:i.Newline}),j++;else if(null!==(l=e.exec(a.slice(j)))){var o=NaN;try{o=parseInt(l[1])}catch(p){}var q=NaN;try{q=parseInt(l[3])}catch(p){}h({type:i.Lf,length:isNaN(o)?null:o,precision:isNaN(q)?null:q}),j+=l[0].length-1}else b.push(m)}return g(i.Badge)>0&&b.push(" "),g(i.Lf)>0&&0===g(i.Unit)&&c[c.length-1].type===i.Lf&&b.push(" "),h(),c}function d(b,c){var d,e,f=b.length,g=0,h=NaN,i=NaN,j=function(a){if(null===a)return NaN;if(2===a.length)return a[1];if(3===a.length)return a[1]-a[2];throw"Unsupported point of length "+a.length};if("MIN"===c)return a.each(b,function(a){e=j(b[a]),isNaN(e)||(isNaN(h)||h>e)&&(h=e)}),h;if("MAX"===c)return a.each(b,function(a){e=j(b[a]),isNaN(e)||(isNaN(i)||e>i)&&(i=e)}),i;if("AVERAGE"===c||"AVG"===c)return f=0,a.each(b,function(a){e=j(b[a]),isNaN(e)||(g+=e,f++)}),f>0?g/f:NaN;if("LAST"===c){for(d=f-1;d>=0;d--)if(e=j(b[d]),!isNaN(e))return e;return NaN}throw"Unsupported aggregation: "+c}function e(b,c,d){var e;if(a.each(c,function(a){c[a].metric===b&&(e=c[a])}),void 0===e&&void 0!==d.hiddenSeries&&a.each(d.hiddenSeries,function(a){d.hiddenSeries[a].metric===b&&(e=d.hiddenSeries[a])}),void 0===e)throw"No series with metric '"+statement.metric+"' was found.";return e}function f(b,e,f){var g=c(b.value),h="";a.each(g,function(a){var c=g[a];if(c.type===i.Text)f.drawText(c.value);else if(c.type===i.Badge)f.drawBadge(e.color);else if(c.type===i.Newline)f.drawNewline();else if(c.type===i.Unit)""===h&&(h=" "),f.drawText(h+" ");else{if(c.type!==i.Lf)throw"Unsupported token: "+JSON.stringify(c);var j=d(e.data,b.aggregation),k=j;if(h="",!isNaN(j)){var l=d3.formatPrefix(j,c.precision);h=l.symbol,k=l.scale(j)}var m="";null!==c.length&&(m+=c.length),null!==c.precision&&(m+="."+c.precision),m+="f",m=d3.format(m),f.drawText(m(k))}})}function g(c){c.hooks.processOptions.push(function(c,d){if(!(d.legend.statements.length<1)){d.legend.show=!1;var g=b,h=new g(c,d);d.grid.margin.bottom=h.getLegendHeight(),c.hooks.draw.push(function(b){h.beforeDraw();var c=b.getData();a.each(d.legend.statements,function(a){var b=d.legend.statements[a],g=void 0;void 0!==b.metric&&(g=e(b.metric,c,d)),f(b,g,h)}),h.afterDraw()})}})}var h={legend:{statements:[],margin:{left:5,right:0,top:0,bottom:0},style:{fontSize:10,badgeSize:10,lineSpacing:5}}},i=Object.freeze({Badge:"badge",Text:"text",Unit:"unit",Lf:"lf",Newline:"newline"});b.prototype={},b.prototype.constructor=b,b.prototype.getLineWidth=function(){return this.opts.legend.style.lineSpacing+Math.max(this.opts.legend.style.badgeSize,this.opts.legend.style.fontSize)},b.prototype.getLegendHeight=function(){var b=0,c=0,d=this;return a.each(this.opts.legend.statements,function(a){var e=d.opts.legend.statements[a];e.value.indexOf("\\n")>-1?(b++,c=0):c++}),c>0&&b++,b*this.lineWidth+h.legend.margin.top+h.legend.margin.bottom},b.prototype.beforeDraw=function(){this.ctx=this.plot.getCanvas().getContext("2d"),this.xMin=this.opts.legend.margin.left,this.yMin=this.ctx.canvas.clientHeight-this.getLegendHeight()+this.opts.legend.margin.top,this.x=this.xMin,this.y=this.yMin},b.prototype.drawText=function(a){this.ctx.fillStyle="black",this.ctx.font=this.fontSize+"px Monospace",this.ctx.textAlign="left",this.ctx.fillText(a,this.x,this.y+this.fontSize);var b=this.ctx.measureText(a);this.x+=b.width},b.prototype.drawBadge=function(a){this.ctx.fillStyle=a,this.ctx.fillRect(this.x,this.y,this.badgeSize,this.badgeSize),this.ctx.beginPath(),this.ctx.lineWidth="0.5",this.ctx.strokeStyle="black",this.ctx.rect(this.x,this.y,this.badgeSize,this.badgeSize),this.ctx.stroke(),this.ctx.x+=this.badgeSize,this.drawText(" ")},b.prototype.drawNewline=function(){this.y=this.lineWidth+this.y,this.x=this.xMin},b.prototype.afterDraw=function(){this.ctx.save()},a.plot.plugins.push({init:g,options:h,name:"legend",version:"1.0.0"})}(jQuery);