/*! flot-legend 2.0.0 - built on 2016-11-23 */
!function(a){"use strict";function b(a,b,c){this.plot=a,this.opts=b,this.tokens=c,this.doRender=!0,this.setFontSize(this.opts.legend.style.fontSize)}function c(a){for(var b=[],c=[],d={},e=/^%(\d*)(\.(\d+))?lf/,f=function(a){d.hasOwnProperty(a)?d[a]+=1:d[a]=1},g=function(a){return d.hasOwnProperty(a)?d[a]:0},h=function(a){b.length>0&&(c.push({type:i.Text,value:b.join("")}),b=[],f(i.Text)),void 0!==a&&(c.push(a),f(a.type))},j=0,k=a.length;j<k;j++){var l,m=a[j],n=a[Math.min(j+1,k-1)];if("%"===m&&"g"===n)h({type:i.Badge}),j++;else if("%"===m&&"s"===n)h({type:i.Unit}),j++;else if("%"===m&&"%"===n)b.push("%"),j++;else if("\\"==m&&"n"==n)h({type:i.Newline}),j++;else if("\\"==m&&"l"==n)h({type:i.Newline}),j++;else if("\\"==m&&"s"==n)h({type:i.Newline}),j++;else if(null!==(l=e.exec(a.slice(j)))){var o=NaN;try{o=parseInt(l[1])}catch(a){}var p=NaN;try{p=parseInt(l[3])}catch(a){}h({type:i.Lf,length:isNaN(o)?null:o,precision:isNaN(p)?null:p}),j+=l[0].length-1}else b.push(m)}return g(i.Badge)>0&&b.push(" "),g(i.Lf)>0&&0===g(i.Unit)&&c[c.length-1].type===i.Lf&&b.push(" "),h(),c}function d(b,c){var d,e,f=b.length,g=0,h=NaN,i=NaN,j=function(a){if(null===a)return NaN;if(2===a.length)return a[1];if(3===a.length)return a[1]-a[2];throw"Unsupported point of length "+a.length};if("MIN"===c)return a.each(b,function(a){e=j(b[a]),isNaN(e)||(isNaN(h)||e<h)&&(h=e)}),h;if("MAX"===c)return a.each(b,function(a){e=j(b[a]),isNaN(e)||(isNaN(i)||e>i)&&(i=e)}),i;if("AVERAGE"===c||"AVG"===c)return f=0,a.each(b,function(a){e=j(b[a]),isNaN(e)||(g+=e,f++)}),f>0?g/f:NaN;if("LAST"===c){for(d=f-1;d>=0;d--)if(e=j(b[d]),!isNaN(e))return e;return NaN}throw"Unsupported aggregation: "+c}function e(b,c,d){var e;if(a.each(c,function(a){c[a].metric===b&&(e=c[a])}),void 0===e&&void 0!==d.hiddenSeries&&a.each(d.hiddenSeries,function(a){d.hiddenSeries[a].metric===b&&(e=d.hiddenSeries[a])}),void 0===e)throw"No series with metric '"+b+"' was found.";return e}function f(b,e,f){var g=c(b.format),h="";a.each(g,function(a){var c=g[a];if(c.type===i.Text)f.drawText(c.value);else if(c.type===i.Badge)f.drawBadge(e.color);else if(c.type===i.Newline)f.drawNewline();else if(c.type===i.Unit)""===h&&(h=" "),f.drawText(h+" ");else{if(c.type!==i.Lf)throw"Unsupported token: "+JSON.stringify(c);var j;j=b.aggregation?d(e.data,b.aggregation):b.value;var k=j;if(h="",!isNaN(j)){var l=d3.formatPrefix(j,c.precision);h=l.symbol,k=l.scale(j)}var m="";null!==c.length&&(m+=c.length),null!==c.precision&&(m+="."+c.precision),m+="f",m=d3.format(m),f.drawText(m(k))}})}function g(d){d.hooks.processOptions.push(function(d,g){if(!(g.legend.statements.length<1)){g.legend.show=!1;var h=[];a.each(g.legend.statements,function(a){var b=g.legend.statements[a];h.push(c(b.format))}),h=Array.prototype.concat.apply([],h);var i=b,j=new i(d,g,h);g.grid.margin={top:0,left:0,bottom:j.getLegendHeight(),right:0};var k=function(b){j.beforeDraw(),a.each(g.legend.statements,function(a){var c=g.legend.statements[a],d=void 0;void 0!==c.metric&&(d=e(c.metric,b,g)),f(c,d,j)}),j.afterDraw()};d.hooks.draw.push(function(a){var b=a.getCanvas().clientWidth,c=0,d=a.getOptions().legend,e=d.style.fontSize,f=d.style.minFontSize,g=a.getData();j.setDryRun(!0);do{if(j.setFontSize(e),k(g),c=j.getMaxWidth(),!(c>b))break;if(e===f)break;e--}while(c>b);j.setDryRun(!1),k(g)})}})}var h={legend:{statements:[],margin:{left:5,right:0,top:0,bottom:0},style:{fontSize:10,minFontSize:3,lineSpacing:5}}},i=Object.freeze({Badge:"badge",Text:"text",Unit:"unit",Lf:"lf",Newline:"newline"});b.prototype={},b.prototype.constructor=b,b.prototype.setDryRun=function(a){this.doRender=!a},b.prototype.getFontSize=function(){return this.badgeSize},b.prototype.setFontSize=function(a){this.fontSize=a,this.badgeSize=a,this.badgeMarginRight=Math.max(1,Math.round(.25*a)),this.lineHeight=this.getLineHeight()},b.prototype.getBadgeSize=function(){return this.badgeSize},b.prototype.updateMaxWidth=function(){this.maxWidth=Math.max(this.maxWidth,this.x)},b.prototype.getMaxWidth=function(){return this.maxWidth},b.prototype.getLineHeight=function(){return this.opts.legend.style.lineSpacing+Math.max(this.badgeSize,this.fontSize)},b.prototype.getLegendHeight=function(){var b=0,c=0,d=this;return a.each(d.tokens,function(a){d.tokens[a];d.tokens[a].type===i.Newline?(b++,c=0):c++}),c>0&&b++,b*this.lineHeight+h.legend.margin.top+h.legend.margin.bottom},b.prototype.beforeDraw=function(){this.ctx=this.plot.getCanvas().getContext("2d"),this.xMin=this.opts.legend.margin.left,this.yMin=this.ctx.canvas.clientHeight-this.getLegendHeight()+this.opts.legend.margin.top,this.x=this.xMin,this.y=this.yMin,this.maxWidth=this.x},b.prototype.drawText=function(a){this.ctx.fillStyle="black",this.ctx.font=this.fontSize+"px Monospace",this.ctx.textAlign="left",this.doRender&&this.ctx.fillText(a,this.x,this.y+this.fontSize);var b=this.ctx.measureText(a);this.x+=b.width,this.updateMaxWidth()},b.prototype.drawBadge=function(a){this.doRender&&(this.ctx.fillStyle=a,this.ctx.fillRect(this.x,this.y,this.badgeSize,this.badgeSize),this.ctx.beginPath(),this.ctx.lineHeight="0.5",this.ctx.strokeStyle="black",this.ctx.rect(this.x,this.y,this.badgeSize,this.badgeSize),this.ctx.stroke()),this.x+=this.badgeSize+this.badgeMarginRight,this.updateMaxWidth()},b.prototype.drawNewline=function(){this.y=this.lineHeight+this.y,this.x=this.xMin},b.prototype.afterDraw=function(){this.doRender&&this.ctx.save()},a.plot.plugins.push({init:g,options:h,name:"legend",version:"2.0.0"})}(jQuery);