import{j as b,o as g,k as t,l as Y,r as N,A as V,p as G,d as x,m as C,z as v,s as f,u as o,a3 as z,v as S,a4 as Q,t as k,x as X,be as tt,F as A,_ as B,n as J,aa as st,c as et,K as at,a1 as ot,S as h,bf as nt,ar as it,b as q,B as T,y as E,D as lt,aP as H,f as rt,a5 as ct,a6 as ut}from"./index-CIzR5Qdh.js";import{C as dt}from"./ConfigurationHelper-DVI5kfD2.js";const pt=(_,i)=>{const n=_.__vccOpts||_;for(const[r,u]of i)n[r]=u;return n},ft={},mt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"};function _t(_,i){return g(),b("svg",mt,i[0]||(i[0]=[t("path",{d:"M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20ZM15.36,8.64l-4.95,4.95-2.3-2.3a1,1,0,0,0-1.41,0h0a1,1,0,0,0,0,1.41l3,3a1,1,0,0,0,1.41,0l5.66-5.66a1,1,0,0,0,0-1.41h0A1,1,0,0,0,15.36,8.64Z"},null,-1)]))}const gt=pt(ft,[["render",_t]]),{showSnackBar:O}=G(),D=Y("usageStatisticsStore",()=>{const _=N({enabled:!1}),i=N({metadata:[]}),n=N({}),r=async()=>{const c=await V.getUsageStatistics();c&&(n.value=c)},u=async()=>{const c=await V.getUsageStatisticsMetadata();c&&(i.value=c)},d=async()=>{const c=await V.getUsageStatisticsStatus();c&&(_.value=c)},p=async()=>{await l(!0)&&d()},y=async()=>{await l(!1)&&d()},l=async c=>{const w=await V.setUsageStatisticsStatus(c),U=!!(w&&(w.status===200||w.status===202));return O(U?c?{msg:"Usage Statistics Sharing is now enabled. Thank you for helping us improve OpenNMS."}:{msg:"Usage Statistics Sharing is now disabled."}:{msg:`Error attempting to ${c?"enable":"disable"} Usage Statistics Sharing.`,error:!0}),U};return{status:_,metadata:i,statistics:n,getStatistics:r,getMetadata:u,getStatus:d,enableSharing:p,disableSharing:y}}),vt={class:"usage-stats-header"},St={class:"flex title-padding"},bt={id:"status-chip-wrapper"},yt={class:"flex button-wrapper"},ht={class:"flex title-padding"},kt={class:"flex button-wrapper"},Ct=x({__name:"UsageStatisticsHeader",setup(_){const{showSnackBar:i}=G(),n=D(),r=C(()=>n.status),u=C(()=>n.statistics),d=async()=>{const y=JSON.stringify(u.value,null,2);try{await dt.copyToClipboard(y),i({msg:"Copied Usage Statistics Json to clipboard"})}catch(l){i({msg:`Could not copy to clipboard. Your environment may be insecure. (${l})`,error:!0})}},p=()=>{r.value.enabled?n.disableSharing():n.enableSharing()};return(y,l)=>(g(),b("div",vt,[l[2]||(l[2]=t("div",null,[t("p",null,[v(" OpenNMS anonymously sends usage statistics data to "),t("a",{href:"https://stats.opennms.org",target:"_blank"},"OpenNMS Statistics"),v(". We use this data to help us improve your OpenNMS software, subject to the "),t("a",{href:"https://www.opennms.com/privacy/",target:"_blank"},"privacy policy"),v(". ")])],-1)),l[3]||(l[3]=t("div",{class:"spacer-medium"},null,-1)),t("div",St,[t("div",bt,[f(o(z),{mode:"single",label:"Usage statistics status"},{default:S(()=>[f(o(Q),{id:o(r).enabled?"chip-status-enabled":"chip-status-disabled"},{icon:S(()=>[f(o(X),{icon:o(r).enabled?o(gt):o(tt)},null,8,["icon"])]),default:S(()=>[v(" "+k(o(r).enabled?"Enabled":"Disabled"),1)]),_:1},8,["id"])]),_:1})]),t("div",yt,[f(o(A),{class:"button",secondary:"",onClick:p},{default:S(()=>[v(k(o(r).enabled?"Disable":"Enable"),1)]),_:1})])]),l[4]||(l[4]=t("div",{class:"spacer-large"},null,-1)),l[5]||(l[5]=t("div",null,[t("h2",null,"List of data points")],-1)),t("div",ht,[l[1]||(l[1]=t("p",null," Copy the full JSON payload to your clipboard ",-1)),t("div",kt,[f(o(A),{class:"button",secondary:"",onClick:d},{default:S(()=>l[0]||(l[0]=[v("Copy Json")])),_:1,__:[0]})])])]))}}),Nt=B(Ct,[["__scopeId","data-v-ca45b8c4"]]),$t={class:"content"},wt=x({__name:"UsageStatisticsModal",props:{subtitle:{required:!1,type:String},visible:{required:!0,type:Boolean}},setup(_){const i=_,n=J({title:"Usage Statistics",close:"Close"});return st(()=>{n.title=i.subtitle?`Usage Statistics: ${i.subtitle}`:"Usage Statistics"}),(r,u)=>(g(),et(o(ot),{modelValue:i.visible,"onUpdate:modelValue":[u[0]||(u[0]=d=>i.visible=d),u[1]||(u[1]=d=>r.$emit("close"))],relative:"",labels:o(n)},{default:S(()=>[t("div",$t,[at(r.$slots,"content",{},void 0,!0)])]),_:3},8,["modelValue","labels"]))}}),Ut=B(wt,[["__scopeId","data-v-07276109"]]),Mt={ref:"tableWrap",id:"wrap",class:"usage-stats-table"},It={summary:"Usage Statistics Sharing"},Vt={key:0},Et=["onClick"],xt={key:1},Bt=["onClick"],Lt={key:2},Ot={key:0},Dt={class:"full-value-wrapper"},Ft={class:"full-value-contents"},j=100,At=x({__name:"UsageStatisticsTable",setup(_){const i=D(),n=J({name:h.NONE,key:h.ASCENDING,description:h.NONE,latestValue:h.NONE}),r=N(""),u=N(""),d=N(!1),p=N({property:"key",value:h.ASCENDING}),y=C(()=>i.statistics),l=C(()=>i.metadata),c=C(()=>{const s=new Map;for(const e of l.value.metadata){const a={key:e.key,name:e.name||"",description:e.description||"",datatype:e.datatype||"string"};s.set(e.key,a)}return s}),w=C(()=>{const s=[];if(y.value&&l.value)for(const m of Object.keys(y.value)){const I=y.value[m],L=c.value.get(m),{isLink:R,latestValue:Z}=U(I,L),W={key:m,name:L?.name||"",description:L?.description||"",isLink:R,latestValue:Z};s.push(W)}let e=[0,0];p.value.value===h.ASCENDING?e=[-1,1]:p.value.value===h.DESCENDING&&(e=[1,-1]);const a=p.value.property;return s.sort((m,I)=>m[a]>I[a]?e[0]:m[a]<I[a]?e[1]:0)}),U=(s,e)=>{let a="",$=!1;const m=e?.datatype||"";return m?m==="string"?a=s||"--":m==="boolean"?a=s&&s===!0?"Yes":"No":m==="number"?a=new Intl.NumberFormat().format(s):m==="object"&&($=!0):nt(s)?a=s||"--":it(s)?a=new Intl.NumberFormat().format(s):$=!0,{isLink:$,latestValue:a}},K=s=>!s.isLink&&s.latestValue&&s.latestValue.length>j,P=s=>`${s.latestValue.substring(0,j)}...`,M=s=>{for(const e in n)n[e]=h.NONE;n[`${s.property}`]=s.value,p.value=s},F=s=>{const e=y.value[s.key]||{},a={[s.key]:e},$=JSON.stringify(a,null,2);u.value=s.name||s.key||"",r.value=$,d.value=!0};return q(()=>{const s=document.getElementById("wrap"),e=document.querySelector("div.usage-stats-table table thead");s&&e&&s.addEventListener("scroll",function(){const a=`translate(0, ${this.scrollTop}px)`;e.style.transform=a})}),(s,e)=>(g(),b(T,null,[t("div",null,[t("div",Mt,[t("table",It,[t("thead",null,[t("tr",null,[f(o(E),{scope:"col",property:"name",sort:o(n).name,onSortChanged:M},{default:S(()=>e[1]||(e[1]=[v("Name")])),_:1,__:[1]},8,["sort"]),f(o(E),{scope:"col",property:"key",sort:o(n).key,onSortChanged:M},{default:S(()=>e[2]||(e[2]=[v("Key name")])),_:1,__:[2]},8,["sort"]),f(o(E),{scope:"col",property:"description",sort:o(n).description,onSortChanged:M},{default:S(()=>e[3]||(e[3]=[v("Description")])),_:1,__:[3]},8,["sort"]),f(o(E),{scope:"col",property:"latestValue",sort:o(n).latestValue,onSortChanged:M},{default:S(()=>e[4]||(e[4]=[v("Latest value")])),_:1,__:[4]},8,["sort"])])]),t("tbody",null,[(g(!0),b(T,null,lt(o(w),a=>(g(),b("tr",{key:a.key},[t("td",null,k(a.name),1),t("td",null,k(a.key),1),t("td",null,k(a.description),1),a.isLink?(g(),b("td",Vt,[t("a",{href:"#",onClick:H(()=>F(a),["prevent"])},"See full value",8,Et)])):K(a)?(g(),b("td",xt,[v(k(P(a))+" ",1),t("a",{href:"#",onClick:H(()=>F(a),["prevent"])},"See full value",8,Bt)])):(g(),b("td",Lt,k(a.latestValue),1))]))),128))])])],512)]),f(Ut,{onClose:e[0]||(e[0]=a=>d.value=!1),subtitle:o(u),visible:o(d)},{content:S(()=>[o(d)?(g(),b("div",Ot,[t("div",Dt,[t("div",Ft,k(o(r)),1)])])):rt("",!0)]),_:1},8,["subtitle","visible"])],64))}}),Tt=B(At,[["__scopeId","data-v-95d1065e"]]),Ht={class:"card"},jt={class:"feather-row"},Gt={class:"feather-col-12"},Jt={class:"feather-row"},qt={class:"feather-col-12"},Kt={class:"usage-stats-container"},Pt={class:"table-container"},Rt=x({__name:"UsageStatistics",setup(_){const i=ct(),n=D(),r=C(()=>i.mainMenu.homeUrl),u=C(()=>[{label:"Home",to:r.value,isAbsoluteLink:!0},{label:"Usage Statistics Collection",to:"#",position:"last"}]);return q(async()=>{n.getStatus(),n.getMetadata(),n.getStatistics()}),(d,p)=>(g(),b("div",Ht,[t("div",jt,[t("div",Gt,[f(ut,{items:o(u)},null,8,["items"])])]),t("div",Jt,[t("div",qt,[t("div",Kt,[t("div",Pt,[p[0]||(p[0]=t("div",{class:"title-container"},[t("span",{class:"title"},"Usage Statistics Sharing")],-1)),f(Nt),p[1]||(p[1]=t("div",{class:"spacer-medium"},null,-1)),f(Tt)])])])])]))}}),Yt=B(Rt,[["__scopeId","data-v-2e77318d"]]);export{Yt as default};
